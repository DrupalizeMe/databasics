<?php
// $Id$

/**
 * Simple nodeapi implementation.
 */
function databasics_nodeapi(&$node, $op, $teaser = FALSE, $page = FALSE) {
  global $user;
  
  switch ($op) {
    case 'view':
      if ($page) {
        $view_count = db_result(db_query("SELECT view_count FROM {databasics} WHERE nid = %d AND uid = %d", $node->nid, $user->uid));
        if (!$view_count) {
          $view_count = 1;
          db_query("INSERT INTO {databasics} (nid, uid, view_count) VALUES (%d, %d, %d)", $node->nid, $user->uid, $view_count);
        }
        else {
          $view_count++;
          db_query("UPDATE {databasics} SET view_count = %d WHERE nid = %d AND uid = %d", $view_count, $node->nid, $user->uid);        
        }
        
        $node->content['node_views'] = array(
          '#value' => t('You have viewed this page %num times', array('%num' => $view_count)),
          '#weight' => 10,
        );
      }      
      break;
  }
}
